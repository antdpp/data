# Assuming expiries and logMoneyness are loaded as follows
logMoneyness = pd.read_csv(os.path.join(wd, 'data', 'logMoneyness.txt'), delimiter=",", header=None).values.flatten()
expiries = pd.read_csv(os.path.join(wd, 'data', 'expiries.txt'), delimiter=",", header=None).values.flatten()

# Ensure the expiries and logMoneyness are correctly printed
print("Expiries:", expiries)
print("LogMoneyness:", logMoneyness)

# Define the dimensions
strikes_dim = len(np.unique(logMoneyness))
maturities_dim = len(np.unique(expiries))

# Plotting
plt.figure(1, figsize=(24, 12))  # Increase the figsize to make the subplots larger

# Average relative error
ax = plt.subplot(1, 3, 1)
err = np.mean(100 * np.abs((X_sample - prediction) / X_sample), axis=0)
plt.title("Average relative error", fontsize=15, y=1.04)
im = plt.imshow(err.reshape(maturities_dim, strikes_dim).T, aspect='auto')
cbar = plt.colorbar(im, format=mtick.PercentFormatter())
cbar.ax.tick_params(labelsize=12)
ax.set_xticks(np.arange(maturities_dim))
ax.set_xticklabels([f"{x:.3f}" for x in np.unique(expiries)])
ax.set_yticks(np.arange(strikes_dim))
ax.set_yticklabels([f"{x:.4f}" for x in np.unique(logMoneyness)])
plt.xlabel("Maturity", fontsize=15, labelpad=5)
plt.ylabel("Log-Moneyness", fontsize=15, labelpad=5)

# Std relative error
ax = plt.subplot(1, 3, 2)
err = 100 * np.std(np.abs((X_sample - prediction) / X_sample), axis=0)
plt.title("Std relative error", fontsize=15, y=1.04)
im = plt.imshow(err.reshape(maturities_dim, strikes_dim).T, aspect='auto')
cbar = plt.colorbar(im, format=mtick.PercentFormatter())
cbar.ax.tick_params(labelsize=12)
ax.set_xticks(np.arange(maturities_dim))
ax.set_xticklabels([f"{x:.3f}" for x in np.unique(expiries)])
ax.set_yticks(np.arange(strikes_dim))
ax.set_yticklabels([f"{x:.4f}" for x in np.unique(logMoneyness)])
plt.xlabel("Maturity", fontsize=15, labelpad=5)
plt.ylabel("Log-Moneyness", fontsize=15, labelpad=5)

# Maximum relative error
ax = plt.subplot(1, 3, 3)
err = 100 * np.max(np.abs((X_sample - prediction) / X_sample), axis=0)
plt.title("Maximum relative error", fontsize=15, y=1.04)
im = plt.imshow(err.reshape(maturities_dim, strikes_dim).T, aspect='auto')
cbar = plt.colorbar(im, format=mtick.PercentFormatter())
cbar.ax.tick_params(labelsize=12)
ax.set_xticks(np.arange(maturities_dim))
ax.set_xticklabels([f"{x:.3f}" for x in np.unique(expiries)])
ax.set_yticks(np.arange(strikes_dim))
ax.set_yticklabels([f"{x:.4f}" for x in np.unique(logMoneyness)])
plt.xlabel("Maturity", fontsize=15, labelpad=5)
plt.ylabel("Log-Moneyness", fontsize=15, labelpad=5)

# Adjust layout to prevent overlap and save the plot
plt.tight_layout()
plt.subplots_adjust(wspace=0.4, hspace=0.4)  # Adjust spacing between subplots
plt.savefig('rBergomiTermStructureNNErrors.PNG', dpi=300)
plt.show()

